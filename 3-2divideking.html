<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‘‘ ë‚˜ëˆ—ì…ˆ ì™•! - ì´ˆë“±í•™êµ 3í•™ë…„ 2í•™ê¸°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #e0e5ec;
            --primary-color: #4a86e8;
            --green-color: #6abf69;
            --red-color: #ff6e6e;
            --text-color: #555;
            --light-shadow: rgba(255, 255, 255, 0.9);
            --dark-shadow: rgba(163, 177, 198, 0.6);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Gowun Dodum', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--text-color);
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .container {
            width: 95%;
            max-width: 800px;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-shadow: 1px 1px 2px var(--dark-shadow);
        }

        h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
        }
        
        .hidden {
            display: none !important;
        }

        /* --- í™”ë©´ ê³µí†µ ìŠ¤íƒ€ì¼ --- */
        .screen {
            background-color: var(--bg-color);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 8px 8px 15px var(--dark-shadow), -8px -8px 15px var(--light-shadow);
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        /* --- ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ --- */
        .general-btn {
            padding: 12px 25px;
            font-size: 1rem;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            background-color: var(--bg-color);
            box-shadow: 5px 5px 10px var(--dark-shadow), -5px -5px 10px var(--light-shadow);
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            color: var(--text-color);
        }
        .general-btn:hover {
            transform: translateY(-2px);
            color: var(--primary-color);
        }
        .general-btn:active {
            box-shadow: inset 3px 3px 7px var(--dark-shadow), inset -3px -3px 7px var(--light-shadow);
            transform: translateY(0);
        }


        /* --- ì‹œì‘ í™”ë©´ ìŠ¤íƒ€ì¼ --- */
        #start-screen .chapter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .chapter-btn {
            padding: 15px 10px;
            /* Inherits general-btn styles */
        }

        .chapter-btn.selected {
            box-shadow: inset 5px 5px 10px var(--dark-shadow), inset -5px -5px 10px var(--light-shadow);
            color: var(--primary-color);
            font-weight: bold;
        }

        .mode-selection {
            margin: 30px 0;
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .mode-selection label {
            padding: 15px 30px;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 5px 5px 10px var(--dark-shadow), -5px -5px 10px var(--light-shadow);
            transition: all 0.2s ease-in-out;
        }
        
        .mode-selection input[type="radio"] {
            display: none;
        }

        .mode-selection input[type="radio"]:checked + label {
            box-shadow: inset 5px 5px 10px var(--dark-shadow), inset -5px -5px 10px var(--light-shadow);
            color: var(--primary-color);
            font-weight: bold;
        }

        .start-btn {
            padding: 15px 50px;
            font-size: 1.5rem;
            font-weight: bold;
            border-radius: 15px;
            border: none;
            cursor: pointer;
            background: var(--primary-color);
            color: white;
            box-shadow: 5px 5px 10px var(--dark-shadow), -5px -5px 10px var(--light-shadow);
            transition: all 0.2s ease-in-out;
        }

        .start-btn:hover {
            background: #3a7bd5;
            transform: translateY(-3px);
        }
        
        .start-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            box-shadow: inset 2px 2px 5px var(--dark-shadow), inset -2px -2px 5px var(--light-shadow);
        }

        /* --- ê²Œì„ í™”ë©´ ìŠ¤íƒ€ì¼ --- */
        #game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        #menu-back-btn {
            /* Using general-btn style */
            padding: 10px 20px;
            font-size: 0.9rem;
        }


        #progress-container {
            width: 100%;
            height: 10px;
            background-color: rgba(163, 177, 198, 0.3);
            border-radius: 5px;
            margin: 10px 0;
            box-shadow: inset 2px 2px 5px var(--dark-shadow), inset -2px -2px 5px var(--light-shadow);
        }

        #progress-bar {
            width: 0%;
            height: 100%;
            background-color: var(--green-color);
            border-radius: 5px;
            transition: width 0.3s ease-in-out;
        }

        #game-stats {
            display: flex;
            gap: 20px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        #problem-container {
            margin: 30px 0;
            padding: 40px 20px;
            border-radius: 15px;
            box-shadow: inset 5px 5px 10px var(--dark-shadow), inset -5px -5px 10px var(--light-shadow);
        }
        
        #problem-text {
            font-size: 3.5rem;
            font-weight: bold;
            letter-spacing: 5px;
        }

        #answer-form {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        #numeric-inputs {
            display: flex;
            justify-content: center;
            gap: 30px; /* ëª«ê³¼ ë‚˜ë¨¸ì§€ ì‚¬ì´ ê°„ê²© */
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .input-group {
            display: flex;
            flex-direction: column; /* ë¼ë²¨ê³¼ ì¸í’‹ì„ ìœ„ì•„ë˜ë¡œ ì •ë ¬ */
            align-items: center;
            gap: 5px;
        }

        .input-group label {
            font-size: 1rem;
        }

        .answer-input {
            width: 100px;
            padding: 10px;
            border: none;
            border-radius: 10px;
            text-align: center;
            font-size: 1.5rem;
            background-color: var(--bg-color);
            box-shadow: inset 3px 3px 6px var(--dark-shadow), inset -3px -3px 6px var(--light-shadow);
            color: var(--text-color);
        }

        .answer-input:focus {
            outline: none;
            box-shadow: inset 3px 3px 6px var(--dark-shadow), inset -3px -3px 6px var(--light-shadow), 0 0 0 2px var(--primary-color);
        }

        #check-btn {
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            background: var(--green-color);
            color: white;
            box-shadow: 5px 5px 10px var(--dark-shadow), -5px -5px 10px var(--light-shadow);
            transition: all 0.2s ease-in-out;
        }
        #check-btn:hover {
            transform: translateY(-2px);
        }

        #feedback-area {
            min-height: 40px; /* í”¼ë“œë°± ì˜ì—­ ìµœì†Œ ë†’ì´ í™•ë³´ */
            margin-top: 15px;
            margin-bottom: 15px;
        }
        
        #feedback {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        #show-answer-btn {
            /* Inherits general-btn styles */
            background: var(--primary-color);
            color: white;
            padding: 10px 20px;
            font-size: 1.1rem;
        }

        .feedback-correct { color: var(--green-color); animation: bounce 0.5s; }
        .feedback-wrong { color: var(--red-color); animation: shake 0.5s; }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }
        @keyframes shake {
            0%, 100% {transform: translateX(0);}
            10%, 30%, 50%, 70%, 90% {transform: translateX(-5px);}
            20%, 40%, 60%, 80% {transform: translateX(5px);}
        }
        
        .boolean-question button {
            padding: 15px 30px;
            font-size: 1.5rem;
            margin: 0 10px;
        }

        /* --- ê²°ê³¼ í™”ë©´ ìŠ¤íƒ€ì¼ --- */
        #results-message {
            font-size: 2rem;
            margin-bottom: 25px; /* ê³µê°„ ì¶”ê°€ */
            color: var(--primary-color);
        }

        #results-details {
            font-size: 1.5rem;
            margin-bottom: 35px; /* ê³µê°„ ì¶”ê°€ */
            line-height: 1.6; /* ì¤„ê°„ê²© ì¶”ê°€ */
        }
        
        .result-btn-group {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 600px) {
            h1 { font-size: 2.5rem; }
            #problem-text { font-size: 2.8rem; }
            .screen { padding: 20px; }
            #game-header { flex-direction: column; gap: 10px; }
            #game-stats { order: 3; } /* í†µê³„ ë§¨ ì•„ë˜ë¡œ */
            #menu-back-btn { order: 1; margin-bottom: 10px; }
            #chapter-title { order: 2; width: 100%; }
        }

    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ‘‘ ë‚˜ëˆ—ì…ˆ ì™• ğŸ‘‘</h1>
        
        <!-- ì‹œì‘ í™”ë©´ -->
        <div id="start-screen" class="screen">
            <h2>ë„ì „í•  ì±•í„°ë¥¼ ê³¨ë¼ì£¼ì„¸ìš”!</h2>
            <div class="chapter-grid">
                <button class="chapter-btn general-btn" data-chapter="1">1. ë‚´ë¦¼ ì—†ëŠ” (ëª‡ì‹­)Ã·(ëª‡)</button>
                <button class="chapter-btn general-btn" data-chapter="2">2. ë‚´ë¦¼ ì—†ëŠ” (ëª‡ì‹­ëª‡)Ã·(ëª‡)</button>
                <button class="chapter-btn general-btn" data-chapter="3">3. ë‚´ë¦¼ ìˆëŠ” (ëª‡ì‹­)Ã·(ëª‡)</button>
                <button class="chapter-btn general-btn" data-chapter="4">4. ë‚´ë¦¼ ìˆëŠ” (ëª‡ì‹­ëª‡)Ã·(ëª‡)</button>
                <button class="chapter-btn general-btn" data-chapter="5">5. ë‚´ë¦¼ ì—†ê³  ë‚˜ë¨¸ì§€ ìˆëŠ” (ëª‡ì‹­ëª‡)Ã·(ëª‡)</button>
                <button class="chapter-btn general-btn" data-chapter="6">6. ë‚´ë¦¼ ìˆê³  ë‚˜ë¨¸ì§€ ìˆëŠ” (ëª‡ì‹­ëª‡)Ã·(ëª‡)</button>
                <button class="chapter-btn general-btn" data-chapter="7">7. ë‚˜ë¨¸ì§€ê°€ ìˆëŠ” ë‚˜ëˆ—ì…ˆ ê³„ì‚° í™•ì¸í•˜ê¸°</button>
                <button class="chapter-btn general-btn" data-chapter="8">8. (ì„¸ ìë¦¬ ìˆ˜)Ã·(í•œ ìë¦¬ ìˆ˜)</button>
                <button class="chapter-btn general-btn" data-chapter="9">9. ë‚˜ë¨¸ì§€ê°€ ìˆëŠ” (ì„¸ ìë¦¬ ìˆ˜)Ã·(í•œ ìë¦¬ ìˆ˜)</button>
            </div>
            
            <h2>ëª¨ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”!</h2>
            <div class="mode-selection">
                <input type="radio" id="practice-mode" name="mode" value="practice" checked>
                <label for="practice-mode">ğŸ“ ì—°ìŠµ ëª¨ë“œ</label>
                
                <input type="radio" id="challenge-mode" name="mode" value="challenge">
                <label for="challenge-mode">ğŸ† ë„ì „ ëª¨ë“œ</label>
            </div>
            
            <button id="start-btn" class="start-btn" disabled>ì‹œì‘í•˜ê¸°!</button>
        </div>

        <!-- ê²Œì„ í™”ë©´ -->
        <div id="game-screen" class="screen hidden">
            <div id="game-header">
                <h2 id="chapter-title"></h2>
                <div id="game-stats">
                    <span id="score">ì ìˆ˜: 0</span>
                    <span id="timer" class="hidden">ì‹œê°„: 120</span>
                </div>
                <button id="menu-back-btn" class="general-btn">ğŸ  ë©”ë‰´ë¡œ</button>
            </div>
            
            <div id="progress-container">
                <div id="progress-bar"></div>
            </div>
            
            <div id="problem-container">
                <div id="problem-text"></div>
            </div>

            <form id="answer-form">
                <!-- ì¼ë°˜ ë¬¸ì œìš© (ëª«/ë‚˜ë¨¸ì§€ ì…ë ¥) -->
                <div id="numeric-inputs">
                    <div class="input-group">
                        <label for="quotient">ëª«:</label>
                        <input type="number" id="quotient" class="answer-input" autocomplete="off" inputmode="numeric">
                    </div>
                    <div class="input-group" id="remainder-group">
                        <label for="remainder">ë‚˜ë¨¸ì§€:</label>
                        <input type="number" id="remainder" class="answer-input" autocomplete="off" inputmode="numeric">
                    </div>
                </div>
                
                <!-- 7ë²ˆ ì±•í„°ìš© (O/X ë²„íŠ¼) -->
                <div id="boolean-question" class="hidden">
                    <button type="button" class="boolean-btn general-btn" data-answer="true">â­• ë§ì•„ìš”</button>
                    <button type="button" class="boolean-btn general-btn" data-answer="false">âŒ í‹€ë ¤ìš”</button>
                </div>
                
                <div id="feedback-area">
                    <div id="feedback"></div>
                    <button type="button" id="show-answer-btn" class="general-btn hidden">ì •ë‹µ ë³´ê¸°</button>
                </div>
                
                <button id="check-btn">í™•ì¸</button>
            </form>
            
        </div>

        <!-- ê²°ê³¼ í™”ë©´ -->
        <div id="results-screen" class="screen hidden">
            <h2 id="results-message">ì°¸ ì˜í–ˆì–´ìš”!</h2>
            <div id="results-details">
                <p>ì´ 10ë¬¸ì œ ì¤‘ <span id="final-score"></span>ë¬¸ì œë¥¼ ë§í˜”ì–´ìš”!</p>
                <p id="final-time"></p>
            </div>
            <div class="result-btn-group">
                <button id="restart-btn" class="general-btn">ê°™ì€ ì±•í„° ë‹¤ì‹œ ë„ì „</button>
                <button id="main-menu-btn" class="general-btn">ì²˜ìŒìœ¼ë¡œ</button>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- DOM ìš”ì†Œ ì„ íƒ ---
    const startScreen = document.getElementById('start-screen');
    const gameScreen = document.getElementById('game-screen');
    const resultsScreen = document.getElementById('results-screen');
    
    const chapterBtns = document.querySelectorAll('.chapter-btn');
    const startBtn = document.getElementById('start-btn');
    const chapterTitle = document.getElementById('chapter-title');
    const scoreDisplay = document.getElementById('score');
    const timerDisplay = document.getElementById('timer');
    const progressBar = document.getElementById('progress-bar');
    const problemText = document.getElementById('problem-text');
    const answerForm = document.getElementById('answer-form');
    const numericInputs = document.getElementById('numeric-inputs');
    const quotientInput = document.getElementById('quotient');
    const remainderGroup = document.getElementById('remainder-group');
    const remainderInput = document.getElementById('remainder');
    const booleanQuestion = document.getElementById('boolean-question');
    const checkBtn = document.getElementById('check-btn');
    const feedback = document.getElementById('feedback');
    const menuBackBtn = document.getElementById('menu-back-btn');
    const showAnswerBtn = document.getElementById('show-answer-btn');

    const finalScore = document.getElementById('final-score');
    const finalTime = document.getElementById('final-time');
    const restartBtn = document.getElementById('restart-btn');
    const mainMenuBtn = document.getElementById('main-menu-btn');

    // --- ê²Œì„ ìƒíƒœ ë³€ìˆ˜ ---
    let state = {
        chapter: null,
        mode: 'practice',
        questions: [],
        currentQuestionIndex: 0,
        score: 0,
        timer: 120,
        timerId: null,
        totalQuestions: 10
    };
    
    const chapterNames = [
        "1. ë‚´ë¦¼ ì—†ëŠ” (ëª‡ì‹­)Ã·(ëª‡)", "2. ë‚´ë¦¼ ì—†ëŠ” (ëª‡ì‹­ëª‡)Ã·(ëª‡)",
        "3. ë‚´ë¦¼ ìˆëŠ” (ëª‡ì‹­)Ã·(ëª‡)", "4. ë‚´ë¦¼ ìˆëŠ” (ëª‡ì‹­ëª‡)Ã·(ëª‡)",
        "5. ë‚´ë¦¼ ì—†ê³  ë‚˜ë¨¸ì§€ ìˆëŠ” (ëª‡ì‹­ëª‡)Ã·(ëª‡)", "6. ë‚´ë¦¼ ìˆê³  ë‚˜ë¨¸ì§€ ìˆëŠ” (ëª‡ì‹­ëª‡)Ã·(ëª‡)",
        "7. ë‚˜ë¨¸ì§€ê°€ ìˆëŠ” ë‚˜ëˆ—ì…ˆ ê³„ì‚° í™•ì¸í•˜ê¸°", "8. (ì„¸ ìë¦¬ ìˆ˜)Ã·(í•œ ìë¦¬ ìˆ˜)",
        "9. ë‚˜ë¨¸ì§€ê°€ ìˆëŠ” (ì„¸ ìë¦¬ ìˆ˜)Ã·(í•œ ìë¦¬ ìˆ˜)"
    ];

    // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
    
    chapterBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            chapterBtns.forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            state.chapter = parseInt(btn.dataset.chapter);
            startBtn.disabled = false;
        });
    });

    document.querySelectorAll('input[name="mode"]').forEach(radio => {
        radio.addEventListener('click', () => {
            state.mode = radio.value;
        });
    });
    
    startBtn.addEventListener('click', startGame);
    
    menuBackBtn.addEventListener('click', () => {
        if (confirm("í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ê²Œì„ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤. ë©”ì¸ ë©”ë‰´ë¡œ ëŒì•„ê°€ì‹œê² ì–´ìš”?")) {
            resetToMainMenu();
        }
    });

    checkBtn.addEventListener('click', handleAnswer);
    answerForm.addEventListener('submit', (e) => {
        e.preventDefault();
        handleAnswer();
    });
    
    showAnswerBtn.addEventListener('click', showCorrectAnswer);

    document.querySelectorAll('.boolean-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            handleBooleanAnswer(e.target.dataset.answer === 'true');
        });
    });

    restartBtn.addEventListener('click', () => {
        resultsScreen.classList.add('hidden');
        startGame();
    });
    mainMenuBtn.addEventListener('click', () => {
        resultsScreen.classList.add('hidden');
        resetToMainMenu();
    });

    // --- í•µì‹¬ í•¨ìˆ˜ ---
    
    function startGame() {
        if (state.timerId) clearInterval(state.timerId);

        state.currentQuestionIndex = 0;
        state.score = 0;
        state.timer = 120;

        state.questions = generateQuestions(state.chapter, state.totalQuestions);
        
        startScreen.classList.add('hidden');
        resultsScreen.classList.add('hidden');
        gameScreen.classList.remove('hidden');
        
        chapterTitle.textContent = chapterNames[state.chapter - 1];
        scoreDisplay.textContent = `ì ìˆ˜: 0`;

        if (state.mode === 'challenge') {
            timerDisplay.classList.remove('hidden');
            startTimer();
        } else {
            timerDisplay.classList.add('hidden');
        }
        
        showAnswerBtn.classList.add('hidden');
        
        displayQuestion();
    }

    function displayQuestion() {
        if (state.currentQuestionIndex >= state.totalQuestions) {
            endGame();
            return;
        }

        const q = state.questions[state.currentQuestionIndex];
        problemText.innerHTML = q.text;
        
        feedback.textContent = '';
        feedback.className = '';
        showAnswerBtn.classList.add('hidden');
        checkBtn.textContent = 'í™•ì¸';
        checkBtn.disabled = false;
        
        quotientInput.value = '';
        remainderInput.value = '';

        if (state.chapter === 7) {
            numericInputs.classList.add('hidden');
            booleanQuestion.classList.remove('hidden');
            checkBtn.classList.add('hidden');
        } else {
            numericInputs.classList.remove('hidden');
            booleanQuestion.classList.add('hidden');
            checkBtn.classList.remove('hidden');
            
            const hasRemainder = q.remainder !== 0 || (state.chapter >= 5 && state.chapter !== 8);
            if (hasRemainder) {
                remainderGroup.classList.remove('hidden');
            } else {
                remainderGroup.classList.add('hidden');
            }
            quotientInput.focus();
        }
        
        updateProgress();
    }
    
    function handleAnswer() {
        const currentQ = state.questions[state.currentQuestionIndex];
        const userQuotient = parseInt(quotientInput.value);
        const userRemainder = remainderGroup.classList.contains('hidden') ? 0 : (parseInt(remainderInput.value) || 0);

        if (isNaN(userQuotient)) {
            feedback.textContent = 'ëª«ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”!';
            feedback.className = 'feedback-wrong';
            setTimeout(() => { feedback.textContent = ''; feedback.className = ''; }, 1000);
            return;
        }

        const isCorrect = userQuotient === currentQ.quotient && userRemainder === currentQ.remainder;
        
        processAnswer(isCorrect);
    }
    
    function handleBooleanAnswer(userAnswer) {
        const currentQ = state.questions[state.currentQuestionIndex];
        const isCorrect = userAnswer === currentQ.isEquationCorrect;
        
        processAnswer(isCorrect);
        document.querySelectorAll('.boolean-btn').forEach(btn => btn.disabled = true);
    }
    
    function showCorrectAnswer() {
        const q = state.questions[state.currentQuestionIndex];
        showAnswerBtn.classList.add('hidden');
        
        let answerText = "";
        if(state.chapter === 7) {
            answerText = `ì •ë‹µ: '${q.isEquationCorrect ? 'â­• ë§ì•„ìš”' : 'âŒ í‹€ë ¤ìš”'}'`;
        } else {
            answerText = `ì •ë‹µ: ëª« ${q.quotient}`;
            if (!remainderGroup.classList.contains('hidden') || q.remainder > 0) {
                answerText += `, ë‚˜ë¨¸ì§€ ${q.remainder}`;
            }
        }
        feedback.textContent = "âœ” " + answerText;
        feedback.className = 'feedback-correct';

        setTimeout(() => {
            state.currentQuestionIndex++;
            displayQuestion();
            document.querySelectorAll('.boolean-btn').forEach(btn => btn.disabled = false);
        }, 1500);
    }

    function processAnswer(isCorrect) {
        checkBtn.disabled = true;

        if (isCorrect) {
            feedback.textContent = 'ë”©ë™ëŒ•! ì •ë‹µì´ì—ìš”! ğŸ‰';
            feedback.className = 'feedback-correct';
            state.score++;
            
            setTimeout(() => {
                state.currentQuestionIndex++;
                displayQuestion();
                document.querySelectorAll('.boolean-btn').forEach(btn => btn.disabled = false);
            }, 1500);

        } else {
            feedback.className = 'feedback-wrong';
            
            if (state.mode === 'practice') {
                feedback.textContent = 'ì•„ì‰¬ì›Œìš”, ë‹¤ì‹œ ìƒê°í•´ë´ìš”! ğŸ˜¥';
                showAnswerBtn.classList.remove('hidden');
            } else {
                feedback.textContent = 'ì˜¤ë‹µì…ë‹ˆë‹¤! ğŸ˜¥';
                setTimeout(() => {
                    state.currentQuestionIndex++;
                    displayQuestion();
                    document.querySelectorAll('.boolean-btn').forEach(btn => btn.disabled = false);
                }, 1500);
            }
        }
        
        scoreDisplay.textContent = `ì ìˆ˜: ${state.score}`;
    }

    function updateProgress() {
        const progress = (state.currentQuestionIndex / state.totalQuestions) * 100;
        progressBar.style.width = `${progress}%`;
    }

    function startTimer() {
        timerDisplay.textContent = `ì‹œê°„: ${state.timer}`;
        state.timerId = setInterval(() => {
            state.timer--;
            timerDisplay.textContent = `ì‹œê°„: ${state.timer}`;
            if (state.timer <= 0) {
                clearInterval(state.timerId);
                endGame();
            }
        }, 1000);
    }

    function endGame() {
        if (state.timerId) clearInterval(state.timerId);
        
        gameScreen.classList.add('hidden');
        resultsScreen.classList.remove('hidden');

        finalScore.textContent = state.score;
        
        if (state.score === state.totalQuestions) {
            resultsMessage.textContent = 'ğŸ‰ ì™„ë²½í•´ìš”! ë‹¹ì‹ ì´ ë°”ë¡œ ë‚˜ëˆ—ì…ˆ ì™•! ğŸ‘‘';
        } else if (state.score >= state.totalQuestions * 0.7) {
            resultsMessage.textContent = 'ğŸ‘ ì •ë§ ì˜í–ˆì–´ìš”! ì¡°ê¸ˆë§Œ ë” í˜ë‚´ìš”!';
        } else {
            resultsMessage.textContent = 'ğŸ¤” ì•„ì‰¬ì›Œìš”! ì—°ìŠµí•˜ë©´ ë” ì˜í•  ìˆ˜ ìˆì–´ìš”.';
        }

        if (state.mode === 'challenge') {
            const timeTaken = 120 - state.timer;
            finalTime.textContent = `ê±¸ë¦° ì‹œê°„: ${timeTaken}ì´ˆ`;
            finalTime.classList.remove('hidden');
        } else {
            finalTime.classList.add('hidden');
        }
    }

    function resetToMainMenu() {
        if (state.timerId) clearInterval(state.timerId);

        gameScreen.classList.add('hidden');
        resultsScreen.classList.add('hidden');
        startScreen.classList.remove('hidden');
        
        state.chapter = null;
        startBtn.disabled = true;
        chapterBtns.forEach(b => b.classList.remove('selected'));
    }

    // --- ë¬¸ì œ ìƒì„± ë¡œì§ (ê¸°ì¡´ ìœ ì§€) ---
    const randInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

    function generateQuestions(chapter, count) {
        const questions = new Set();
        while (questions.size < count) {
            let q;
            switch(chapter) {
                case 1: q = genCh1(); break;
                case 2: q = genCh2(); break;
                case 3: q = genCh3(); break;
                case 4: q = genCh4(); break;
                case 5: q = genCh5(); break;
                case 6: q = genCh6(); break;
                case 7: q = genCh7(); break;
                case 8: q = genCh8(); break;
                case 9: q = genCh9(); break;
            }
            questions.add(JSON.stringify(q));
        }
        return Array.from(questions).map(q => JSON.parse(q));
    }

    function genCh1() {
        const divisor = randInt(2, 4);
        const quotient_tens = randInt(1, 4);
        const quotient = quotient_tens * 10;
        const dividend = divisor * quotient;
        return { text: `${dividend} &div; ${divisor}`, dividend, divisor, quotient, remainder: 0 };
    }

    function genCh2() {
        const divisor = randInt(2, 4);
        const quotient_tens = randInt(1, 4);
        const quotient_ones = randInt(1, Math.floor(9 / divisor));
        const quotient = quotient_tens * 10 + quotient_ones;
        const dividend = divisor * quotient;
        return { text: `${dividend} &div; ${divisor}`, dividend, divisor, quotient, remainder: 0 };
    }
    
    function genCh3() {
        const divisor = randInt(3, 8);
        const quotient = randInt(11, 30);
        const dividend = divisor * quotient;
        if ( (Math.floor(dividend/10)) % divisor !== 0 && dividend % 10 === 0) {
             return { text: `${dividend} &div; ${divisor}`, dividend, divisor, quotient, remainder: 0 };
        }
        return genCh3();
    }
    
    function genCh4() {
        const divisor = randInt(3, 8);
        const quotient = randInt(11, 30);
        const dividend = divisor * quotient;
        if ( (Math.floor(dividend/10)) % divisor !== 0 && dividend % 10 !== 0) {
            return { text: `${dividend} &div; ${divisor}`, dividend, divisor, quotient, remainder: 0 };
        }
        return genCh4();
    }

    function genCh5() {
        const divisor = randInt(2, 4);
        const quotient_tens = randInt(1, 4);
        const quotient_ones = randInt(0, Math.floor(9 / divisor));
        const quotient = quotient_tens * 10 + quotient_ones;
        const remainder = randInt(1, divisor - 1);
        const dividend = divisor * quotient + remainder;
        if ( (Math.floor(dividend/10)) % divisor === 0) {
             return { text: `${dividend} &div; ${divisor}`, dividend, divisor, quotient, remainder };
        }
        return genCh5();
    }

    function genCh6() {
        const divisor = randInt(3, 8);
        const quotient = randInt(11, 30);
        const remainder = randInt(1, divisor - 1);
        const dividend = divisor * quotient + remainder;
        if ( (Math.floor(dividend/10)) % divisor !== 0) {
            return { text: `${dividend} &div; ${divisor}`, dividend, divisor, quotient, remainder };
        }
        return genCh6();
    }

    function genCh7() {
        const divisor = randInt(3, 9);
        const quotient = randInt(5, 20);
        const remainder = randInt(0, divisor - 1);
        const dividend = divisor * quotient + remainder;
        
        const isEquationCorrect = Math.random() > 0.4;
        let displayedQuotient = quotient;
        let displayedRemainder = remainder;

        if (!isEquationCorrect) {
            if (Math.random() > 0.5) {
                displayedQuotient += randInt(1,3) * (Math.random() > 0.5 ? 1 : -1);
                if (displayedQuotient < 0) displayedQuotient = 0;
            } else {
                displayedRemainder = remainder;
                while (displayedRemainder === remainder) {
                    if (remainder === 0) {
                        displayedRemainder = randInt(1, divisor - 1);
                    } else {
                        displayedRemainder = (Math.random() > 0.5) ? 0 : divisor; 
                    }
                }
            }
        }
        
        let remainderText = displayedRemainder > 0 ? `... ${displayedRemainder}` : '';
        const text = `${dividend} &div; ${divisor} = ${displayedQuotient} ${remainderText}`;
        return { text, isEquationCorrect };
    }

    function genCh8() {
        const divisor = randInt(2, 9);
        const quotient = randInt(101, 300);
        const dividend = divisor * quotient;
        if(dividend > 999) return genCh8();
        return { text: `${dividend} &div; ${divisor}`, dividend, divisor, quotient, remainder: 0 };
    }

    function genCh9() {
        const divisor = randInt(2, 9);
        const quotient = randInt(101, 300);
        const remainder = randInt(1, divisor - 1);
        const dividend = divisor * quotient + remainder;
        if(dividend > 999) return genCh9();
        return { text: `${dividend} &div; ${divisor}`, dividend, divisor, quotient, remainder };
    }
});
</script>

</body>
</html>
