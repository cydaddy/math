<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì´ˆë“± 3í•™ë…„ 2í•™ê¸° ê³±ì…ˆ ì—°ì‚°ì™•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ê³µì±… ëŠë‚Œì˜ ê·¸ë¦¬ë“œ ë°°ê²½ */
        body {
            background-color: #f0f9ff; /* bg-sky-50 */
            background-image:
                linear-gradient(rgba(17, 94, 89, 0.1) 1px, transparent 1px),
                linear-gradient(to right, rgba(17, 94, 89, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            background-attachment: fixed;
        }

        /* ìˆ«ì ì…ë ¥ì°½ ìœ„ì•„ë˜ í™”ì‚´í‘œ(ìŠ¤í”¼ë„ˆ) ì œê±° */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        /* ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes popIn {
            0% { transform: scale(0.5) rotate(-15deg); opacity: 0; }
            80% { transform: scale(1.1) rotate(5deg); opacity: 1; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .pop-in { animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards; }
        .shake { animation: shake 0.3s ease-in-out forwards; }
        
        /* ì¶•í•˜ í­ì£½ ì• ë‹ˆë©”ì´ì…˜ */
        #fireworks-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: 9999;
        }
        .firework {
            position: absolute;
            bottom: 0;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background-color: #fff;
            animation: shoot 2s ease-out forwards;
        }
        @keyframes shoot {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-90vh); opacity: 0; }
        }
        .firework::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 100%;
            width: 80px;
            height: 80px;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            opacity: 0;
            animation: explode 1s ease-out forwards;
            animation-delay: 2s;
        }
        @keyframes explode {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1.5); opacity: 0; }
        }
        .firework:nth-child(5n+1)::before { box-shadow: 0 0 15px 5px #ff4757, 0 0 25px 15px #ff6b81; }
        .firework:nth-child(5n+2)::before { box-shadow: 0 0 15px 5px #5352ed, 0 0 25px 15px #5352ed; }
        .firework:nth-child(5n+3)::before { box-shadow: 0 0 15px 5px #2ed573, 0 0 25px 15px #2ed573; }
        .firework:nth-child(5n+4)::before { box-shadow: 0 0 15px 5px #ffa502, 0 0 25px 15px #ffa502; }
        .firework:nth-child(5n+5)::before { box-shadow: 0 0 15px 5px #f78fb3, 0 0 25px 15px #f78fb3; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center font-sans p-4">
    <div id="app" class="container mx-auto max-w-4xl text-center">

        <!-- íƒ€ì´í‹€ -->
        <header class="mb-8">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-teal-700 whitespace-nowrap">ğŸ‰ ì´ˆë“± 3í•™ë…„ 2í•™ê¸° ê³±ì…ˆ ì—°ì‚°ì™• ğŸ‰</h1>
            <p class="text-gray-600 mt-2">ì°¨ê·¼ì°¨ê·¼ ë‹¨ê³„ë¥¼ ì™„ë£Œí•˜ê³  ê³±ì…ˆì˜ ì™•ì´ ë˜ì–´ë³´ì„¸ìš”!</p>
        </header>

        <!-- [ë³€ê²½ë¨] ë‹¨ê³„ ì„ íƒ: Flexboxë¥¼ ì‚¬ìš©í•˜ì—¬ ê°€ìš´ë° ì •ë ¬ -->
        <section id="stage-selection" class="flex flex-wrap justify-center gap-4 mb-8">
            <!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ë‹¨ê³„ ë²„íŠ¼ ìƒì„± -->
        </section>

        <!-- ë¬¸ì œ í’€ì´ ì˜ì—­ -->
        <main id="quiz-area" class="bg-white/80 backdrop-blur-sm p-6 sm:p-8 rounded-2xl shadow-lg w-full max-w-2xl mx-auto" style="display: none;">
            <h2 id="stage-title" class="text-xl sm:text-2xl font-bold text-blue-600 mb-2"></h2>
            <p id="progress-text" class="text-gray-500 mb-6">ë¬¸ì œ 1 / 5</p>
            
            <div id="problem-display" class="text-6xl font-mono font-bold text-gray-800 my-8 flex justify-center items-center space-x-4">
                <span id="num1"></span><span>Ã—</span><span id="num2"></span>
            </div>

            <input type="number" id="answer-input" class="w-full max-w-xs mx-auto text-3xl p-3 border-4 border-yellow-400 rounded-lg text-center focus:outline-none focus:ring-4 focus:ring-yellow-300 transition" placeholder="ì •ë‹µì€?">
            
            <button id="submit-btn" class="mt-6 w-full max-w-xs mx-auto bg-green-500 hover:bg-green-600 text-white font-bold text-2xl py-3 px-6 rounded-lg shadow-md transform hover:scale-105 transition">í™•ì¸</button>
            
            <div id="feedback" class="mt-4 text-xl sm:text-2xl font-bold h-8"></div>
        </main>

        <!-- ìµœì¢… ì¶•í•˜ í™”ë©´ -->
        <div id="final-celebration" class="hidden">
            <div id="fireworks-container"></div>
            <div class="bg-white/80 backdrop-blur-sm p-8 rounded-2xl shadow-2xl pop-in">
                <h2 class="text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-purple-500 to-pink-500 mb-4">ğŸ‘‘ ìµœê³ ! ğŸ‘‘</h2>
                <p class="text-3xl font-bold text-gray-800 mb-8">ë‹¹ì‹ ì€ ìµœê³ ì˜ ê³±ì…ˆ ì—°ì‚°ì™•ì…ë‹ˆë‹¤!</p>
                <p class="text-lg text-gray-600">ëª¨ë“  ë¬¸ì œë¥¼ í•´ê²°í•œ ë‹¹ì‹ ì´ ì •ë§ ìë‘ìŠ¤ëŸ¬ì›Œìš”!</p>
                <button onclick="location.reload()" class="mt-8 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg text-xl">ì²˜ìŒë¶€í„° ë‹¤ì‹œ ë„ì „!</button>
            </div>
        </div>
    </div>

    <script>
        const appState = { currentStage: -1, unlockedStage: 0, currentProblemIndex: 0, problemsPerStage: 5, currentAnswer: 0 };
        const stages = [
            { name: "1ë‹¨ê³„: ì˜¬ë¦¼ ì—†ëŠ” (ì„¸ ìë¦¬ ìˆ˜) Ã— (í•œ ìë¦¬ ìˆ˜)", generator: generateNoCarry3x1 },
            { name: "2ë‹¨ê³„: ì˜¬ë¦¼ í•œ ë²ˆ ìˆëŠ” (ì„¸ ìë¦¬ ìˆ˜) Ã— (í•œ ìë¦¬ ìˆ˜)", generator: generateOneCarry3x1 },
            { name: "3ë‹¨ê³„: ì˜¬ë¦¼ ì—¬ëŸ¬ ë²ˆ ìˆëŠ” (ì„¸ ìë¦¬ ìˆ˜) Ã— (í•œ ìë¦¬ ìˆ˜)", generator: generateMultiCarry3x1 },
            { name: "4ë‹¨ê³„: (í•œ ìë¦¬ ìˆ˜/ë‘ ìë¦¬ ìˆ˜) Ã— (ëª‡ì‹­)", generator: generateTensMultiply },
            { name: "5ë‹¨ê³„: (í•œ ìë¦¬ ìˆ˜) Ã— (ëª‡ì‹­ëª‡)", generator: generate1x2 },
            { name: "6ë‹¨ê³„: ì˜¬ë¦¼ í•œ ë²ˆ ìˆëŠ” (ë‘ ìë¦¬ ìˆ˜) Ã— (ë‘ ìë¦¬ ìˆ˜)", generator: generateOneCarry2x2 },
            { name: "7ë‹¨ê³„: ì˜¬ë¦¼ ì—¬ëŸ¬ ë²ˆ ìˆëŠ” (ë‘ ìë¦¬ ìˆ˜) Ã— (ë‘ ìë¦¬ ìˆ˜)", generator: generateMultiCarry2x2 },
        ];

        const stageSelectionEl = document.getElementById('stage-selection');
        const quizAreaEl = document.getElementById('quiz-area');
        const stageTitleEl = document.getElementById('stage-title');
        const progressTextEl = document.getElementById('progress-text');
        const num1El = document.getElementById('num1');
        const num2El = document.getElementById('num2');
        const answerInputEl = document.getElementById('answer-input');
        const submitBtnEl = document.getElementById('submit-btn');
        const feedbackEl = document.getElementById('feedback');
        const finalCelebrationEl = document.getElementById('final-celebration');
        const fireworksContainerEl = document.getElementById('fireworks-container');

        function getRandomInt(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
        function countCarries(num, multiplier) { let carries = 0, carry = 0; let tempNum = num; while (tempNum > 0) { const digit = tempNum % 10; if (digit * multiplier + carry >= 10) { carries++; } carry = Math.floor((digit * multiplier + carry) / 10); tempNum = Math.floor(tempNum / 10); } return carries; }
        function generateNoCarry3x1() { let num1, num2; do { num1 = getRandomInt(111, 444); num2 = getRandomInt(2, 4); } while (String(num1).includes('0') || String(num1).split('').some(d => parseInt(d) * num2 >= 10)); return [num1, num2]; }
        function generateOneCarry3x1() { let num1, num2; do { num1 = getRandomInt(100, 999); num2 = getRandomInt(2, 9); } while (countCarries(num1, num2) !== 1); return [num1, num2]; }
        function generateMultiCarry3x1() { let num1, num2; do { num1 = getRandomInt(100, 999); num2 = getRandomInt(2, 9); } while (countCarries(num1, num2) < 2); return [num1, num2]; }
        function generateTensMultiply() { const isTwoDigit = Math.random() > 0.5; const num1 = isTwoDigit ? getRandomInt(10, 99) : getRandomInt(2, 9); const num2 = getRandomInt(1, 9) * 10; return [num1, num2]; }
        function generate1x2() { return [getRandomInt(2, 9), getRandomInt(11, 99)]; }
        function countCarries2x2(num1, num2) { const n2d1 = num2 % 10, n2d2 = Math.floor(num2 / 10); let carries = 0, carry1 = 0, tempNum = num1; while(tempNum > 0) { const digit = tempNum % 10; if(digit * n2d1 + carry1 >= 10) carries++; carry1 = Math.floor((digit * n2d1 + carry1) / 10); tempNum = Math.floor(tempNum/10); } let carry2 = 0; tempNum = num1; while(tempNum > 0) { const digit = tempNum % 10; if(digit * n2d2 + carry2 >= 10) carries++; carry2 = Math.floor((digit * n2d2 + carry2) / 10); tempNum = Math.floor(tempNum/10); } return carries; }
        function generateOneCarry2x2() { let num1, num2; do { num1 = getRandomInt(11, 99); num2 = getRandomInt(11, 99); } while (countCarries2x2(num1, num2) !== 1); return [num1, num2]; }
        function generateMultiCarry2x2() { let num1, num2; do { num1 = getRandomInt(11, 99); num2 = getRandomInt(11, 99); } while (countCarries2x2(num1, num2) < 2); return [num1, num2]; }

        function renderStageButtons() {
            stageSelectionEl.innerHTML = '';
            stages.forEach((stage, index) => {
                const button = document.createElement('button');
                button.dataset.stage = index;
                // [ë³€ê²½ë¨] ë²„íŠ¼ì— ê³ ì • ë„ˆë¹„ë¥¼ ì¶”ê°€í•˜ì—¬ flexbox ë ˆì´ì•„ì›ƒì—ì„œ ì¼ê´€ëœ ëª¨ì–‘ì„ ìœ ì§€
                button.className = "p-4 rounded-lg font-bold text-white transition transform hover:scale-105 shadow-md flex flex-col items-center justify-center h-32 w-40";
                const statusSpan = document.createElement('span');
                statusSpan.className = "text-xl mb-1";
                const textSpan = document.createElement('span');
                textSpan.className = "text-sm"; textSpan.textContent = stage.name;
                if (index < appState.unlockedStage) { button.classList.add('bg-green-500'); statusSpan.textContent = 'âœ… ì„±ê³µ!'; button.onclick = () => startStage(index); }
                else if (index === appState.unlockedStage) { button.classList.add('bg-blue-500', 'animate-pulse'); statusSpan.textContent = 'â–¶ï¸ ë„ì „!'; button.onclick = () => startStage(index); }
                else { button.classList.add('bg-gray-400', 'cursor-not-allowed'); statusSpan.textContent = 'ğŸ”’ ì ê¹€'; }
                button.appendChild(statusSpan); button.appendChild(textSpan); stageSelectionEl.appendChild(button);
            });
        }
        function newProblem() { const [num1, num2] = stages[appState.currentStage].generator(); appState.currentAnswer = num1 * num2; num1El.textContent = num1; num2El.textContent = num2; progressTextEl.textContent = `ë¬¸ì œ ${appState.currentProblemIndex + 1} / ${appState.problemsPerStage}`; answerInputEl.value = ''; answerInputEl.focus(); }
        function startStage(stageIndex) { appState.currentStage = stageIndex; appState.currentProblemIndex = 0; stageSelectionEl.style.display = 'none'; quizAreaEl.style.display = 'block'; quizAreaEl.classList.add('fade-in'); stageTitleEl.textContent = stages[stageIndex].name; newProblem(); }
        function checkAnswer() { const userAnswer = parseInt(answerInputEl.value); feedbackEl.classList.remove('pop-in', 'shake', 'text-green-600', 'text-red-500'); void feedbackEl.offsetWidth; if (userAnswer === appState.currentAnswer) { feedbackEl.textContent = 'ì •ë‹µ! ì°¸ ì˜í–ˆì–´ìš”! ğŸ‰'; feedbackEl.className += ' pop-in text-green-600'; setTimeout(() => { appState.currentProblemIndex++; if (appState.currentProblemIndex >= appState.problemsPerStage) { completeStage(); } else { feedbackEl.textContent = ''; newProblem(); } }, 1500); } else { feedbackEl.textContent = 'ì•„ì‰¬ì›Œìš”, ë‹¤ì‹œ í’€ì–´ë´ìš”! ğŸ¤”'; feedbackEl.className += ' shake text-red-500'; } }
        function completeStage() { if (appState.currentStage === appState.unlockedStage) { appState.unlockedStage++; } if (appState.unlockedStage >= stages.length) { showFinalCelebration(); } else { quizAreaEl.style.display = 'none'; stageSelectionEl.style.display = 'flex'; renderStageButtons(); } }

        function showFinalCelebration() {
            quizAreaEl.style.display = 'none';
            stageSelectionEl.style.display = 'none';
            document.querySelector('header').style.display = 'none';
            
            finalCelebrationEl.classList.remove('hidden');
            launchFireworks();
        }

        function launchFireworks() {
            const fireworkCount = 20;
            for (let i = 0; i < fireworkCount; i++) {
                const firework = document.createElement('div');
                firework.className = 'firework';
                firework.style.left = `${Math.random() * 100}%`;
                firework.style.animationDelay = `${Math.random() * 2}s`;
                fireworksContainerEl.appendChild(firework);
            }
        }

        submitBtnEl.addEventListener('click', checkAnswer);
        answerInputEl.addEventListener('keyup', (event) => { if (event.key === 'Enter') { checkAnswer(); } });
        function init() { renderStageButtons(); }
        init();
    </script>
</body>
</html>